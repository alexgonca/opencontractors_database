CREATE OR REPLACE FUNCTION import_contract_csv(file TEXT)
  RETURNS VOID AS $$
BEGIN
  TRUNCATE temp_contract;

  EXECUTE format('COPY temp_contract FROM ''%s'' WITH CSV HEADER DELIMITER AS '',''', file);

  INSERT INTO contract_csv
  (unique_transaction_id,
   last_modified_date,
   query_progress,
   transaction_status,
   dollarsobligated,
   baseandexercisedoptionsvalue,
   baseandalloptionsvalue,
   maj_agency_cat,
   mod_agency,
   maj_fund_agency_cat,
   contractingofficeagencyid,
   contractingofficeid,
   fundingrequestingagencyid,
   fundingrequestingofficeid,
   fundedbyforeignentity,
   signeddate,
   effectivedate,
   currentcompletiondate,
   ultimatecompletiondate,
   lastdatetoorder,
   contractactiontype,
   reasonformodification,
   typeofcontractpricing,
   priceevaluationpercentdifference,
   subcontractplan,
   lettercontract,
   multiyearcontract,
   performancebasedservicecontract,
   majorprogramcode,
   contingencyhumanitarianpeacekeepingoperation,
   contractfinancing,
   costorpricingdata,
   costaccountingstandardsclause,
   descriptionofcontractrequirement,
   purchasecardaspaymentmethod,
   numberofactions,
   nationalinterestactioncode,
   progsourceagency,
   progsourceaccount,
   progsourcesubacct,
   account_title,
   rec_flag,
   typeofidc,
   multipleorsingleawardidc,
   programacronym,
   vendorname,
   vendoralternatename,
   vendorlegalorganizationname,
   vendordoingasbusinessname,
   divisionname,
   divisionnumberorofficecode,
   vendorenabled,
   vendorlocationdisableflag,
   ccrexception,
   streetaddress,
   streetaddress2,
   streetaddress3,
   city,
   state,
   zipcode,
   vendorcountrycode,
   vendor_state_code,
   vendor_cd,
   congressionaldistrict,
   vendorsitecode,
   vendoralternatesitecode,
   dunsnumber,
   parentdunsnumber,
   phoneno,
   faxno,
   registrationdate,
   renewaldate,
   mod_parent,
   locationcode,
   statecode,
   PlaceofPerformanceCity,
   pop_state_code,
   placeofperformancecountrycode,
   placeofperformancezipcode,
   pop_cd,
   placeofperformancecongressionaldistrict,
   psc_cat,
   productorservicecode,
   systemequipmentcode,
   claimantprogramcode,
   principalnaicscode,
   informationtechnologycommercialitemcategory,
   gfe_gfp,
   useofepadesignatedproducts,
   recoveredmaterialclauses,
   seatransportation,
   contractbundling,
   consolidatedcontract,
   countryoforigin,
   placeofmanufacture,
   manufacturingorganizationtype,
   agencyid,
   piid,
   modnumber,
   transactionnumber,
   fiscal_year,
   idvagencyid,
   idvpiid,
   idvmodificationnumber,
   solicitationid,
   extentcompeted,
   reasonnotcompeted,
   numberofoffersreceived,
   commercialitemacquisitionprocedures,
   commercialitemtestprogram,
   smallbusinesscompetitivenessdemonstrationprogram,
   a76action,
   competitiveprocedures,
   solicitationprocedures,
   typeofsetaside,
   localareasetaside,
   evaluatedpreference,
   fedbizopps,
   research,
   statutoryexceptiontofairopportunity,
   organizationaltype,
   numberofemployees,
   annualrevenue,
   firm8aflag,
   hubzoneflag,
   sdbflag,
   issbacertifiedsmalldisadvantagedbusiness,
   shelteredworkshopflag,
   hbcuflag,
   educationalinstitutionflag,
   womenownedflag,
   veteranownedflag,
   srdvobflag,
   localgovernmentflag,
   minorityinstitutionflag,
   aiobflag,
   stategovernmentflag,
   federalgovernmentflag,
   minorityownedbusinessflag,
   apaobflag,
   tribalgovernmentflag,
   baobflag,
   naobflag,
   saaobflag,
   nonprofitorganizationflag,
   isothernotforprofitorganization,
   isforprofitorganization,
   isfoundation,
   haobflag,
   ishispanicservicinginstitution,
   emergingsmallbusinessflag,
   hospitalflag,
   contractingofficerbusinesssizedetermination,
   is1862landgrantcollege,
   is1890landgrantcollege,
   is1994landgrantcollege,
   isveterinarycollege,
   isveterinaryhospital,
   isprivateuniversityorcollege,
   isschoolofforestry,
   isstatecontrolledinstitutionofhigherlearning,
   isserviceprovider,
   receivescontracts,
   receivesgrants,
   receivescontractsandgrants,
   isairportauthority,
   iscouncilofgovernments,
   ishousingauthoritiespublicortribal,
   isinterstateentity,
   isplanningcommission,
   isportauthority,
   istransitauthority,
   issubchapterscorporation,
   islimitedliabilitycorporation,
   isforeignownedandlocated,
   isarchitectureandengineering,
   isdotcertifieddisadvantagedbusinessenterprise,
   iscitylocalgovernment,
   iscommunitydevelopedcorporationownedfirm,
   iscommunitydevelopmentcorporation,
   isconstructionfirm,
   ismanufacturerofgoods,
   iscorporateentitynottaxexempt,
   iscountylocalgovernment,
   isdomesticshelter,
   isfederalgovernmentagency,
   isfederallyfundedresearchanddevelopmentcorp,
   isforeigngovernment,
   isindiantribe,
   isintermunicipallocalgovernment,
   isinternationalorganization,
   islaborsurplusareafirm,
   islocalgovernmentowned,
   ismunicipalitylocalgovernment,
   isnativehawaiianownedorganizationorfirm,
   isotherbusinessororganization,
   isotherminorityowned,
   ispartnershiporlimitedliabilitypartnership,
   isschooldistrictlocalgovernment,
   issmallagriculturalcooperative,
   issoleproprietorship,
   istownshiplocalgovernment,
   istriballyownedfirm,
   istribalcollege,
   isalaskannativeownedcorporationorfirm,
   iscorporateentitytaxexempt,
   iswomenownedsmallbusiness,
   isecondisadvwomenownedsmallbusiness,
   isjointventurewomenownedsmallbusiness,
   isjointventureecondisadvwomenownedsmallbusiness,
   walshhealyact,
   servicecontractact,
   davisbaconact,
   clingercohenact,
   otherstatutoryauthority,
   prime_awardee_executive1,
   prime_awardee_executive1_compensation,
   prime_awardee_executive2,
   prime_awardee_executive2_compensation,
   prime_awardee_executive3,
   prime_awardee_executive3_compensation,
   prime_awardee_executive4,
   prime_awardee_executive4_compensation,
   prime_awardee_executive5,
   prime_awardee_executive5_compensation,
   interagencycontractingauthority
  )
    SELECT
      nullify_text(unique_transaction_id),
      validate_date(last_modified_date),
      nextval('query_progress'),
      nullify_text(transaction_status),
      nullify_text(dollarsobligated),
      nullify_text(baseandexercisedoptionsvalue),
      nullify_text(baseandalloptionsvalue),
      nullify_text(maj_agency_cat),
      nullify_text(mod_agency),
      nullify_text(maj_fund_agency_cat),
      nullify_text(contractingofficeagencyid),
      nullify_text(contractingofficeid),
      nullify_text(fundingrequestingagencyid),
      nullify_text(fundingrequestingofficeid),
      nullify_text(fundedbyforeignentity),
      nullify_text(signeddate),
      nullify_text(effectivedate),
      nullify_text(currentcompletiondate),
      nullify_text(ultimatecompletiondate),
      nullify_text(lastdatetoorder),
      nullify_text(contractactiontype),
      nullify_text(reasonformodification),
      nullify_text(typeofcontractpricing),
      nullify_text(priceevaluationpercentdifference),
      nullify_text(subcontractplan),
      nullify_text(lettercontract),
      nullify_text(multiyearcontract),
      nullify_text(performancebasedservicecontract),
      nullify_text(majorprogramcode),
      nullify_text(contingencyhumanitarianpeacekeepingoperation),
      nullify_text(contractfinancing),
      nullify_text(costorpricingdata),
      nullify_text(costaccountingstandardsclause),
      nullify_text(descriptionofcontractrequirement),
      nullify_text(purchasecardaspaymentmethod),
      nullify_text(numberofactions),
      nullify_text(nationalinterestactioncode),
      nullify_text(progsourceagency),
      nullify_text(progsourceaccount),
      nullify_text(progsourcesubacct),
      nullify_text(account_title),
      nullify_text(rec_flag),
      nullify_text(typeofidc),
      nullify_text(multipleorsingleawardidc),
      nullify_text(programacronym),
      nullify_text(vendorname),
      nullify_text(vendoralternatename),
      nullify_text(vendorlegalorganizationname),
      nullify_text(vendordoingasbusinessname),
      nullify_text(divisionname),
      nullify_text(divisionnumberorofficecode),
      nullify_text(vendorenabled),
      nullify_text(vendorlocationdisableflag),
      nullify_text(ccrexception),
      nullify_text(streetaddress),
      nullify_text(streetaddress2),
      nullify_text(streetaddress3),
      nullify_text(city),
      nullify_text(state),
      nullify_text(zipcode),
      nullify_text(vendorcountrycode),
      nullify_text(vendor_state_code),
      nullify_text(vendor_cd),
      nullify_text(congressionaldistrict),
      nullify_text(vendorsitecode),
      nullify_text(vendoralternatesitecode),
      nullify_text(dunsnumber),
      nullify_text(parentdunsnumber),
      nullify_text(phoneno),
      nullify_text(faxno),
      nullify_text(registrationdate),
      nullify_text(renewaldate),
      nullify_text(mod_parent),
      nullify_text(locationcode),
      nullify_text(statecode),
      nullify_text(PlaceofPerformanceCity),
      nullify_text(pop_state_code),
      nullify_text(placeofperformancecountrycode),
      nullify_text(placeofperformancezipcode),
      nullify_text(pop_cd),
      nullify_text(placeofperformancecongressionaldistrict),
      nullify_text(psc_cat),
      nullify_text(productorservicecode),
      nullify_text(systemequipmentcode),
      nullify_text(claimantprogramcode),
      nullify_text(principalnaicscode),
      nullify_text(informationtechnologycommercialitemcategory),
      nullify_text(gfe_gfp),
      nullify_text(useofepadesignatedproducts),
      nullify_text(recoveredmaterialclauses),
      nullify_text(seatransportation),
      nullify_text(contractbundling),
      nullify_text(consolidatedcontract),
      nullify_text(countryoforigin),
      nullify_text(placeofmanufacture),
      nullify_text(manufacturingorganizationtype),
      nullify_text(agencyid),
      nullify_text(piid),
      nullify_text(modnumber),
      nullify_text(transactionnumber),
      nullify_text(fiscal_year),
      nullify_text(idvagencyid),
      nullify_text(idvpiid),
      nullify_text(idvmodificationnumber),
      nullify_text(solicitationid),
      nullify_text(extentcompeted),
      nullify_text(reasonnotcompeted),
      nullify_text(numberofoffersreceived),
      nullify_text(commercialitemacquisitionprocedures),
      nullify_text(commercialitemtestprogram),
      nullify_text(smallbusinesscompetitivenessdemonstrationprogram),
      nullify_text(a76action),
      nullify_text(competitiveprocedures),
      nullify_text(solicitationprocedures),
      nullify_text(typeofsetaside),
      nullify_text(localareasetaside),
      nullify_text(evaluatedpreference),
      nullify_text(fedbizopps),
      nullify_text(research),
      nullify_text(statutoryexceptiontofairopportunity),
      nullify_text(organizationaltype),
      nullify_text(numberofemployees),
      nullify_text(annualrevenue),
      nullify_text(firm8aflag),
      nullify_text(hubzoneflag),
      nullify_text(sdbflag),
      nullify_text(issbacertifiedsmalldisadvantagedbusiness),
      nullify_text(shelteredworkshopflag),
      nullify_text(hbcuflag),
      nullify_text(educationalinstitutionflag),
      nullify_text(womenownedflag),
      nullify_text(veteranownedflag),
      nullify_text(srdvobflag),
      nullify_text(localgovernmentflag),
      nullify_text(minorityinstitutionflag),
      nullify_text(aiobflag),
      nullify_text(stategovernmentflag),
      nullify_text(federalgovernmentflag),
      nullify_text(minorityownedbusinessflag),
      nullify_text(apaobflag),
      nullify_text(tribalgovernmentflag),
      nullify_text(baobflag),
      nullify_text(naobflag),
      nullify_text(saaobflag),
      nullify_text(nonprofitorganizationflag),
      nullify_text(isothernotforprofitorganization),
      nullify_text(isforprofitorganization),
      nullify_text(isfoundation),
      nullify_text(haobflag),
      nullify_text(ishispanicservicinginstitution),
      nullify_text(emergingsmallbusinessflag),
      nullify_text(hospitalflag),
      nullify_text(contractingofficerbusinesssizedetermination),
      nullify_text(is1862landgrantcollege),
      nullify_text(is1890landgrantcollege),
      nullify_text(is1994landgrantcollege),
      nullify_text(isveterinarycollege),
      nullify_text(isveterinaryhospital),
      nullify_text(isprivateuniversityorcollege),
      nullify_text(isschoolofforestry),
      nullify_text(isstatecontrolledinstitutionofhigherlearning),
      nullify_text(isserviceprovider),
      nullify_text(receivescontracts),
      nullify_text(receivesgrants),
      nullify_text(receivescontractsandgrants),
      nullify_text(isairportauthority),
      nullify_text(iscouncilofgovernments),
      nullify_text(ishousingauthoritiespublicortribal),
      nullify_text(isinterstateentity),
      nullify_text(isplanningcommission),
      nullify_text(isportauthority),
      nullify_text(istransitauthority),
      nullify_text(issubchapterscorporation),
      nullify_text(islimitedliabilitycorporation),
      nullify_text(isforeignownedandlocated),
      nullify_text(isarchitectureandengineering),
      nullify_text(isdotcertifieddisadvantagedbusinessenterprise),
      nullify_text(iscitylocalgovernment),
      nullify_text(iscommunitydevelopedcorporationownedfirm),
      nullify_text(iscommunitydevelopmentcorporation),
      nullify_text(isconstructionfirm),
      nullify_text(ismanufacturerofgoods),
      nullify_text(iscorporateentitynottaxexempt),
      nullify_text(iscountylocalgovernment),
      nullify_text(isdomesticshelter),
      nullify_text(isfederalgovernmentagency),
      nullify_text(isfederallyfundedresearchanddevelopmentcorp),
      nullify_text(isforeigngovernment),
      nullify_text(isindiantribe),
      nullify_text(isintermunicipallocalgovernment),
      nullify_text(isinternationalorganization),
      nullify_text(islaborsurplusareafirm),
      nullify_text(islocalgovernmentowned),
      nullify_text(ismunicipalitylocalgovernment),
      nullify_text(isnativehawaiianownedorganizationorfirm),
      nullify_text(isotherbusinessororganization),
      nullify_text(isotherminorityowned),
      nullify_text(ispartnershiporlimitedliabilitypartnership),
      nullify_text(isschooldistrictlocalgovernment),
      nullify_text(issmallagriculturalcooperative),
      nullify_text(issoleproprietorship),
      nullify_text(istownshiplocalgovernment),
      nullify_text(istriballyownedfirm),
      nullify_text(istribalcollege),
      nullify_text(isalaskannativeownedcorporationorfirm),
      nullify_text(iscorporateentitytaxexempt),
      nullify_text(iswomenownedsmallbusiness),
      nullify_text(isecondisadvwomenownedsmallbusiness),
      nullify_text(isjointventurewomenownedsmallbusiness),
      nullify_text(isjointventureecondisadvwomenownedsmallbusiness),
      nullify_text(walshhealyact),
      nullify_text(servicecontractact),
      nullify_text(davisbaconact),
      nullify_text(clingercohenact),
      nullify_text(otherstatutoryauthority),
      nullify_text(prime_awardee_executive1),
      nullify_text(prime_awardee_executive1_compensation),
      nullify_text(prime_awardee_executive2),
      nullify_text(prime_awardee_executive2_compensation),
      nullify_text(prime_awardee_executive3),
      nullify_text(prime_awardee_executive3_compensation),
      nullify_text(prime_awardee_executive4),
      nullify_text(prime_awardee_executive4_compensation),
      nullify_text(prime_awardee_executive5),
      nullify_text(prime_awardee_executive5_compensation),
      nullify_text(interagencycontractingauthority)
    FROM temp_contract
  ON CONFLICT (unique_transaction_id, last_modified_date)
    DO NOTHING;
END
$$ LANGUAGE plpgsql;

SELECT import_contract_csv('/home/alex/PycharmProjects/opencontractorsdatabasev2/datafeeds/datafeeds/2012_minor.csv');
SELECT import_contract_csv('/home/alex/PycharmProjects/opencontractorsdatabasev2/datafeeds/datafeeds/2013_minor.csv');
SELECT import_contract_csv('/home/alex/PycharmProjects/opencontractorsdatabasev2/datafeeds/datafeeds/2014_minor.csv');
SELECT import_contract_csv('/home/alex/PycharmProjects/opencontractorsdatabasev2/datafeeds/datafeeds/2015_minor.csv');
SELECT import_contract_csv('/home/alex/PycharmProjects/opencontractorsdatabasev2/datafeeds/datafeeds/2016_minor.csv');